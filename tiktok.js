const translations = {
  en: {
    'lang.option.en': 'English',
    'lang.option.ja': '日本語',
    'lang.option.zh': '中文',
    'nav.projects': 'Projects',
    'nav.journey': 'Journey',
    'nav.contact': 'Contact',
    'hero.greeting': 'Hi,',
    'hero.name': "I'm Xinrou",
    'hero.lead': 'Embrace the world, explore every possibility in life, and bring happiness to the people around you.',
    'hero.resume': 'Resume',
    'labs.title': 'Project Highlights',
    'labs.card1.tag': 'LIVE-AI',
    'labs.card1.title': 'Neon Pulse Studio',
    'labs.card1.desc': 'An interactive live room where GPT agents remix prompts, beats, and lights in real time.',
    'labs.card1.meta': '2024 · Beta',
    'labs.card2.tag': 'AR',
    'labs.card2.title': 'Holo Loop',
    'labs.card2.desc': 'A wearable particle loop crafted with WebAR and Effect House that shifts colors with every beat.',
    'labs.card2.meta': '2023 · Launch',
    'labs.card3.tag': 'DATA',
    'labs.card3.title': 'Creator Radar',
    'labs.card3.desc': 'A signal board combining TikTok API stats, commerce conversion, and content insights for brands.',
    'labs.card3.meta': '2022 · SaaS',
    'timeline.title': 'Experience Journey',
    'timeline.item1.title': '2023 - Now · Creative Tech Lead',
    'timeline.item1.desc': 'Designing commerce-ready livestream systems with AI scene direction and automated overlays.',
    'timeline.item2.title': '2021 - 2023 · Product Storyteller',
    'timeline.item2.desc': 'Directed TikTok-first campaign narratives for lifestyle brands entering short-video ecosystems.',
    'timeline.item3.title': '2019 - 2021 · Immersive Developer',
    'timeline.item3.desc': 'Built AR filters, motion capture puppets, and interactive microsites with cross-device syncing.',
    'timeline.item4.title': '2017 - 2019 · Visual Designer',
    'timeline.item4.desc': 'Crafted kinetic typography packages and festival visuals for entertainment & tech partners.',
    'skills.title': 'Languages & Capabilities',
    'skills.language.title': 'Language Skill',
    'skills.language.english': 'English: full professional proficiency',
    'skills.language.mandarin': 'Mandarin: Native',
    'skills.language.japanese': 'Japanese: full professional proficiency',
    'skills.programming.title': 'Programming Skill',
    'skills.programming.item1': 'TypeScript / React / Next.js frontends',
    'skills.programming.item2': 'Three.js, WebGL, and shader animation',
    'skills.programming.item3': 'Node.js automation & AI toolchains',
    'skills.professional.title': 'Professional Skill',
    'skills.professional.item1': 'Creative direction & interactive storytelling',
    'skills.professional.item2': 'Campaign measurement & content ops',
    'skills.professional.item3': 'Client workshop facilitation',
    'split.offer.title': 'What I Offer',
    'split.offer.item1': 'A passionate partner',
    'split.offer.item2': "A friend who's endlessly curious about the world",
    'split.offer.item3': 'A globally minded multilingual communicator',
    'split.offer.item4': 'A partner committed to lifelong learning',
    'split.contact.title': 'Contact Me',
    'split.contact.body': "Please feel free to contact me anytime—I'm very happy to meet and chat with you.",
    'split.contact.mail': 'Mail',
    'footer.copy': '© 2024 Xinrou · TikTok Tech Edition',
  },
  zh: {
    'lang.option.en': '英文',
    'lang.option.ja': '日文',
    'lang.option.zh': '中文',
    'nav.projects': '项目',
    'nav.journey': '旅程',
    'nav.contact': '联系',
    'hero.greeting': '你好，',
    'hero.name': '我是辛柔',
    'hero.lead': '拥抱世界，探索生活的每一种可能，把快乐带给身边的人。',
    'hero.resume': '简历',
    'labs.title': '项目亮点',
    'labs.card1.tag': 'LIVE-AI',
    'labs.card1.title': '霓虹脉冲工作室',
    'labs.card1.desc': '一个互动直播间，GPT代理会实时混合提示词、节奏和灯光。',
    'labs.card1.meta': '2024 · 测试版',
    'labs.card2.tag': 'AR',
    'labs.card2.title': '全息回环',
    'labs.card2.desc': '一款使用 WebAR 和 Effect House 打造的可穿戴粒子回环，会随着每一次节奏变化变色。',
    'labs.card2.meta': '2023 · 上线',
    'labs.card3.tag': 'DATA',
    'labs.card3.title': '创作者雷达',
    'labs.card3.desc': '一个结合 TikTok API 数据、商业转化与内容洞察的信号面板，服务品牌决策。',
    'labs.card3.meta': '2022 · SaaS',
    'timeline.title': '经历旅程',
    'timeline.item1.title': '2023 至今 · 创意科技负责人',
    'timeline.item1.desc': '设计具备 AI 场景导演与自动叠加的商业直播系统。',
    'timeline.item2.title': '2021 - 2023 · 产品叙事者',
    'timeline.item2.desc': '为生活方式品牌打造面向 TikTok 的首发活动故事。',
    'timeline.item3.title': '2019 - 2021 · 沉浸式开发者',
    'timeline.item3.desc': '构建 AR 滤镜、动作捕捉木偶以及多设备同步的互动站点。',
    'timeline.item4.title': '2017 - 2019 · 视觉设计师',
    'timeline.item4.desc': '为娱乐与科技伙伴创作动感字体包装与节日视觉。',
    'skills.title': '语言与能力',
    'skills.language.title': '语言技能',
    'skills.language.english': '英语：专业流利',
    'skills.language.mandarin': '普通话：母语',
    'skills.language.japanese': '日语：专业流利',
    'skills.programming.title': '编程技能',
    'skills.programming.item1': 'TypeScript / React / Next.js 前端',
    'skills.programming.item2': 'Three.js、WebGL 与着色器动画',
    'skills.programming.item3': 'Node.js 自动化与 AI 工具链',
    'skills.professional.title': '专业能力',
    'skills.professional.item1': '创意统筹与互动叙事',
    'skills.professional.item2': '活动效果衡量与内容运营',
    'skills.professional.item3': '客户工作坊引导',
    'split.offer.title': '我的提供',
    'split.offer.item1': '充满热情的合作伙伴',
    'split.offer.item2': '对世界保持好奇的朋友',
    'split.offer.item3': '具备全球视野的多语沟通者',
    'split.offer.item4': '终身学习的伙伴',
    'split.contact.title': '联系我',
    'split.contact.body': '欢迎随时与我联系——我很期待与你相遇交流。',
    'split.contact.mail': '邮箱',
    'footer.copy': '© 2024 Xinrou · TikTok 科技版',
  },
  ja: {
    'lang.option.en': '英語',
    'lang.option.ja': '日本語',
    'lang.option.zh': '中国語',
    'nav.projects': 'プロジェクト',
    'nav.journey': 'ジャーニー',
    'nav.contact': '連絡先',
    'hero.greeting': 'こんにちは、',
    'hero.name': '私はXinrouです',
    'hero.lead': '世界を抱きしめ、人生のあらゆる可能性を探り、周りの人に幸せを届けます。',
    'hero.resume': '履歴書',
    'labs.title': 'プロジェクトハイライト',
    'labs.card1.tag': 'LIVE-AI',
    'labs.card1.title': 'ネオンパルススタジオ',
    'labs.card1.desc': 'GPTエージェントがリアルタイムでプロンプト・ビート・ライトをリミックスするインタラクティブ配信ルーム。',
    'labs.card1.meta': '2024 · ベータ',
    'labs.card2.tag': 'AR',
    'labs.card2.title': 'ホロループ',
    'labs.card2.desc': 'WebAR と Effect House で制作したウェアラブル粒子ループで、ビートごとに色が変化します。',
    'labs.card2.meta': '2023 · ローンチ',
    'labs.card3.tag': 'DATA',
    'labs.card3.title': 'クリエイターレーダー',
    'labs.card3.desc': 'TikTok API 統計、コマース転換、コンテンツ洞察を統合したブランド向けのシグナルボード。',
    'labs.card3.meta': '2022 · SaaS',
    'timeline.title': '経験ジャーニー',
    'timeline.item1.title': '2023 - 現在 · クリエイティブテックリード',
    'timeline.item1.desc': 'AI シーン演出と自動オーバーレイを備えた商用ライブ配信システムを設計。',
    'timeline.item2.title': '2021 - 2023 · プロダクトストーリーテラー',
    'timeline.item2.desc': 'ライフスタイルブランドの TikTok 初展開向けキャンペーンストーリーを制作。',
    'timeline.item3.title': '2019 - 2021 · イマーシブデベロッパー',
    'timeline.item3.desc': 'AR フィルター、モーションキャプチャパペット、マルチデバイス連動のインタラクティブサイトを構築。',
    'timeline.item4.title': '2017 - 2019 · ビジュアルデザイナー',
    'timeline.item4.desc': 'エンタメ & テックパートナー向けにキネティックタイポグラフィとフェスビジュアルを制作。',
    'skills.title': '言語とスキル',
    'skills.language.title': '言語スキル',
    'skills.language.english': '英語：ビジネス上級',
    'skills.language.mandarin': '中国語：母国語',
    'skills.language.japanese': '日本語：ビジネス上級',
    'skills.programming.title': 'プログラミングスキル',
    'skills.programming.item1': 'TypeScript / React / Next.js フロントエンド',
    'skills.programming.item2': 'Three.js・WebGL・シェーダーアニメーション',
    'skills.programming.item3': 'Node.js 自動化と AI ツールチェーン',
    'skills.professional.title': 'プロフェッショナルスキル',
    'skills.professional.item1': 'クリエイティブディレクションとインタラクティブストーリーテリング',
    'skills.professional.item2': 'キャンペーン計測とコンテンツ運用',
    'skills.professional.item3': 'クライアントワークショップのファシリテーション',
    'split.offer.title': '私が提供できること',
    'split.offer.item1': '情熱的なパートナー',
    'split.offer.item2': '世界への好奇心が尽きない友人',
    'split.offer.item3': 'グローバル志向のマルチリンガルコミュニケーター',
    'split.offer.item4': '生涯学習に寄り添う仲間',
    'split.contact.title': 'お問い合わせ',
    'split.contact.body': 'いつでもお気軽にご連絡ください。お会いしてお話しできるのを楽しみにしています。',
    'split.contact.mail': 'メール',
    'footer.copy': '© 2024 Xinrou · TikTok テックエディション',
  },
};

const DEFAULT_LANGUAGE = 'en';
let currentLanguage = document.documentElement.lang || DEFAULT_LANGUAGE;

function applyTranslations(language, options = {}) {
  const { freezeTyping = true } = options;
  const fallback = translations[DEFAULT_LANGUAGE] || {};
  document.querySelectorAll('[data-i18n]').forEach((element) => {
    const key = element.dataset.i18n;
    if (!key) return;
    const localized = translations[language]?.[key] ?? fallback[key];
    if (!localized) return;
    if (element.classList.contains('typing-text')) {
      const caret = element.parentElement?.querySelector('.typing-caret');
      element.dataset.text = localized;
      element.textContent = localized;
      if (freezeTyping) {
        element.classList.add('typing-complete');
        caret?.classList.add('paused');
      } else {
        element.classList.remove('typing-complete');
        caret?.classList.remove('paused');
      }
    } else {
      element.textContent = localized;
    }
  });
}

function setLanguage(language, options = {}) {
  const { force = false, freezeTyping = true } = options;
  const normalized = translations[language] ? language : DEFAULT_LANGUAGE;
  if (!force && normalized === currentLanguage) {
    return false;
  }
  currentLanguage = normalized;
  applyTranslations(normalized, { freezeTyping });
  document.documentElement.setAttribute('lang', normalized);
  return true;
}

if (currentLanguage !== DEFAULT_LANGUAGE) {
  setLanguage(currentLanguage, { force: true, freezeTyping: false });
} else {
  document.documentElement.setAttribute('lang', currentLanguage);
}

const glowCards = document.querySelectorAll('.glow-card');

function handlePointer(e) {
  const target = e.currentTarget;
  const rect = target.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width) * 100;
  const y = ((e.clientY - rect.top) / rect.height) * 100;
  target.style.setProperty('--mouse-x', `${x}%`);
  target.style.setProperty('--mouse-y', `${y}%`);
}

glowCards.forEach((card) => {
  card.addEventListener('pointermove', handlePointer);
});

let pulseFrame = null;
function animatePulse(timestamp) {
  const intensity = Math.sin(timestamp / 250) * 0.08 + 0.18;
  document.documentElement.style.setProperty('--border', `rgba(12, 16, 35, ${0.08 + intensity})`);
  pulseFrame = requestAnimationFrame(animatePulse);
}

pulseFrame = requestAnimationFrame(animatePulse);

window.addEventListener('beforeunload', () => {
  if (pulseFrame) cancelAnimationFrame(pulseFrame);
});

const languageSwitcher = document.querySelector('.language-switcher');

if (languageSwitcher) {
  const toggle = languageSwitcher.querySelector('.language-toggle');
  const label = languageSwitcher.querySelector('.language-label');
  const options = languageSwitcher.querySelectorAll('.language-option');

  const syncLanguageSelection = () => {
    options.forEach((option) => {
      const isSelected = option.dataset.value === currentLanguage;
      option.setAttribute('aria-selected', isSelected ? 'true' : 'false');
      if (isSelected && label) {
        label.textContent = option.textContent.trim();
      }
    });
  };

  const setOpen = (open) => {
    languageSwitcher.dataset.open = open ? 'true' : 'false';
    if (toggle) {
      toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
    }
  };

  toggle?.addEventListener('click', (event) => {
    event.stopPropagation();
    const isOpen = languageSwitcher.dataset.open === 'true';
    setOpen(!isOpen);
  });

  options.forEach((option) => {
    option.addEventListener('click', () => {
      const langValue = option.dataset.value || DEFAULT_LANGUAGE;
      setLanguage(langValue);
      syncLanguageSelection();
      setOpen(false);
    });
  });

  document.addEventListener('click', (event) => {
    if (!languageSwitcher.contains(event.target)) {
      setOpen(false);
    }
  });

  syncLanguageSelection();
}

const typingLines = document.querySelectorAll('.typing-line');

if (typingLines.length) {
  const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

  const typeLine = (line) =>
    new Promise((resolve) => {
      const textEl = line.querySelector('.typing-text');
      const caretEl = line.querySelector('.typing-caret');
      const fullText = textEl?.dataset.text?.trim() || textEl?.textContent?.trim() || '';
      let index = 0;

      if (textEl) {
        textEl.classList.remove('typing-complete');
        textEl.textContent = '';
      }
      caretEl?.classList.remove('paused');

      const typeNext = () => {
        if (!textEl) {
          resolve();
          return;
        }

        if (index <= fullText.length) {
          textEl.textContent = fullText.slice(0, index);
          index += 1;
          setTimeout(typeNext, 120);
        } else {
          textEl.classList.add('typing-complete');
          caretEl?.classList.add('paused');
          resolve();
        }
      };

      typeNext();
    });

  (async () => {
    await sleep(400);
    for (const line of typingLines) {
      await typeLine(line);
    }
  })();
}
